<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>
    <%= expense.name %> Details
  </title>
  <link rel="icon" href="/images/logo.png" type="image/png" />
  <link rel="stylesheet" href="https://unpkg.com/bulmaswatch/flatly/bulmaswatch.min.css">
  <style>
    .input:active,
    .input:focus,
    .is-active.input,
    .is-active.textarea,
    .is-focused.input,
    .is-focused.textarea,
    .select select.is-active,
    .select select.is-focused,
    .select select:active,
    .select select:focus,
    .textarea:active,
    .textarea:focus {
      border-color: #34495e !important;
      box-shadow: 0 0 0 .125em #34495e33 !important;
    }

    .select:not(.is-multiple):not(.is-loading)::after {
      border-color: #238cd1;
    }
  </style>
</head>

<body>
  <%- include('../partials/_navbar.ejs') %>
    <section class="section">
      <div class="container" style="max-width: 600px">
        <h1 class="title is-1 has-text-centered">
          <%= expense.name %>
        </h1>
        <%- include('../partials/_links.ejs') %>
          <div class="box" style="margin-top: 1.25rem;">
            <p class="ml-2">
              <strong>Type:</strong>
              <%= expense.type %>
            </p>
            <p class="ml-2 mt-2">
              <strong>Schedule:</strong>
              <span>
                <%= expense.costType==="Variable" ? expense.costType : expense.schedule %>
              </span>
            </p>
            <p class="ml-2 mt-2">
              <strong>
                <%= expense.costType==="Variable" ? "Estimated Monthly Cost" : "Cost" %>:
              </strong>
              <%= Intl.NumberFormat(currentUser.currency.locale, { style: 'currency' , currency:
                currentUser.currency.code }).format(expense.cost) %>
            </p>
            <% if (expense.costType==="Variable" ) { %>
              <p class="ml-2 mt-2">
                <strong>Estimation Confidence:</strong>
                <%= Intl.NumberFormat(currentUser.currency.locale, { style: 'currency' , currency:
                  currentUser.currency.code }).format(expense.costLow) %> to
                  <%= Intl.NumberFormat(currentUser.currency.locale, { style: 'currency' , currency:
                    currentUser.currency.code }).format(expense.costHigh) %>
              </p>
              <p class="ml-2 mt-2">
                <strong>Highest Payment:</strong>
                <%= Intl.NumberFormat(currentUser.currency.locale, { style: 'currency' , currency:
                  currentUser.currency.code }).format(expense.historical.reduce((max, entry)=> entry.cost > max.cost ?
                  entry : max, expense.historical[0]).cost) %>
              </p>
              <p class="ml-2 mt-2">
                <strong>Lowest Payment:</strong>
                <%= Intl.NumberFormat(currentUser.currency.locale, { style: 'currency' , currency:
                  currentUser.currency.code }).format(expense.historical.reduce((min, entry)=> entry.cost < min.cost ?
                    entry : min, expense.historical[0]).cost) %>
              </p>
              <% } %>
                <% if (expense.notes && expense.notes.length> 0) { %>
                  <h3 class="subtitle is-5 mt-4 has-text-centered">
                    Notes
                  </h3>
                  <div class="notification mt-4">
                    <span>
                      <%= expense.notes %>
                    </span>
                  </div>
                  <% } %>
                    <div class="field is-grouped is-grouped-centered buttons are-medium">
                      <div class="control">
                        <form action="/users/<%=user._id%>/budget/<%= expense._id %>?_method=DELETE" method="POST">
                        <button class="button is-primary" type="submit" style="width: 80px">
                          Delete
                        </button>
                        </form>
                      </div>
                      <div class="control">
                        <a class="button is-primary is-inverted" style="width: 80px; border: .15rem solid #34495e;"
                          href="/users/<%=user._id%>/budget/<%= expense._id %>/edit">Edit</a>
                      </div>
                    </div>
                    <% if (expense.historical.length> 0) { %>
                      <h3 class="subtitle is-5 mt-5 has-text-centered">
                        Historical Payment Data
                      </h3>
                      <div class="table-container mt-2" style="max-width: 400px; margin-left: auto; margin-right: auto">
                        <table class="table is-fullwidth is-striped is-hoverable has-text-centered">
                          <thead>
                            <tr>
                              <th class="has-text-centered">Date</th>
                              <th class="has-text-centered">Amount</th>
                            </tr>
                          </thead>
                          <tbody>
                            <% expense.historical.forEach((payment)=> { %>
                              <tr>
                                <td>
                                  <%= payment.date.toLocaleDateString(currentUser.currency.locale, { year: 'numeric' ,
                                    month: 'long' , timeZone: 'UTC' , }) %>
                                </td>
                                <td>
                                  <%= Intl.NumberFormat(currentUser.currency.locale, { style: 'currency' , currency:
                                    currentUser.currency.code }).format(payment.cost) %>
                                </td>
                              </tr>
                              <% }) %>
                          </tbody>
                        </table>
                      </div>
                      <% } %>
          </div>
      </div>
    </section>
</body>

</html>